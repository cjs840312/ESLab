<html>
   <head>
      <script src="/socket.io/socket.io.js">
      </script>
   </head>
   <body>
      <h1> Chat Room ~ </h1>
      <div id="ChatScreen" style="width:497px;height:200px;border:1px #000000 solid; overflow:auto; white-space: pre-line;word-break: break-all;"></div>

      <br>

      <form method="post">
         <textarea name="text" rows="5" cols="60" id="message"></textarea>
         <input type="button" value="Send" id="SendButton"/>
      </form>


      <script>
         var socket = io.connect();
         var screen = document.getElementById("ChatScreen");

         var myName,receiver,hisLog;
         socket.emit("whoIsChatting",document.cookie);
         socket.on("chatPair",function(Data){
            myName=Data.sender;
            receiver=Data.receiver;
            hisLog=Data.history;

            for (i = hisLog.length-1; i >=0; i--) { 
               screen.textContent +=(hisLog[i].Sender+": "+hisLog[i].Content+"\n");
               screen.scrollTop=screen.scrollTopMax;
            }
            console.log(hisLog);
         });
         

         var SendButton= document.getElementById("SendButton");
         var textBox = document.getElementById("message");

         SendButton.addEventListener("click",function(){
            console.log('Sending Message')         
            var message= document.getElementById("message").value;

            socket.emit("Message",{receiver:receiver,"message":message});

            textBox.value="";
            screen.textContent +=(myName+": "+message+"\n");
            screen.scrollTop=screen.scrollTopMax;
         });

         var textBox = document.getElementById("message");
         textBox.addEventListener("keydown", function(event) {
            if (event.keyCode == 13 && !event.shiftKey) {
               event.preventDefault();
               textBox.value=textBox.value.trim();
               SendButton.click();
            };
         });

         
         socket.on("Message",function(Data){
            console.log('Printing Message') 
            var sender=Data.sender 
            var message=Data.message
            screen.textContent +=(sender+": "+message+"\n");
            screen.scrollTop=screen.scrollTopMax;
         });

      </script>

   </body>
</html>
