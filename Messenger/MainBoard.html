<html>
   <head>
      <script src="/socket.io/socket.io.js"></script>
   </head>
   <body>

      <h1> Friend List <button type="button", id="LogoutButton">Logout</button> </h1>
      <form method="post">
         <label>Account : </label> 
         <input type="text", id="AddAccount"> 
         <input type="button", value="Add", id="AddButton">
      </form>
      <a href="./Chat.html"> chatroom  </a>

      <script>
         var socket = io.connect();
         
         socket.emit("checkLogin", document.cookie);
         socket.on("notLogin", function(Msg){
            alert(Msg);
            location.href="./";
         });

         socket.emit("showFriendList", document.cookie);
         socket.on("friendList", function(Data){
            for(i=0; i<Data.length; ++i){
               var friend = Data[i].friend;
               var newDiv = document.createElement('div');
               var link = document.createElement('a');
               link.innerHTML = friend;
               link.href = './Chat.html';
               link.addEventListener('click', function(ev){
                  document.cookie = "receiver="+this.innerHTML;
               }, false);
               newDiv.appendChild(link);
               document.body.appendChild(newDiv);
            }
         });

         AddButton.addEventListener("click", function(){
            document.cookie = "receiver="+AddAccount.value;
            socket.emit("addFriend", document.cookie);  
         });
         
         AddAccount.addEventListener("keydown", function(event) {
            if (event.keyCode == 13) {
               event.preventDefault();
               AddButton.click();
            };
         });

         LogoutButton.addEventListener("click", function(){
            document.cookie = "account=";
            location.href = "./";
         });
         
         socket.on("addLink", function(Data){
            var newFriend = Data;
            var newDiv = document.createElement('div');
            var link = document.createElement('a');
            link.innerHTML = newFriend;
            link.href = './Chat.html';
            link.addEventListener('click', function(ev){
               document.cookie = "receiver="+this.innerHTML;
            }, false);
            newDiv.appendChild(link);
            document.body.appendChild(newDiv);
         });

         socket.on("errMessage", function(Msg){
            alert(Msg);
         });


      </script>
   
   </body>
</html>
